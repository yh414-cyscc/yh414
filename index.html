<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Flower</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html, body {
    margin: 0;
    padding: 0;
    background: black;
    overflow: hidden;
    height: 100%;
    touch-action: manipulation;
}
canvas { display: block; }
#hint {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-family: Arial, sans-serif;
    font-size: 24px;
    opacity: 0.9;
    pointer-events: none;
    transition: opacity 0.8s ease;
}
</style>
</head>
<body>

<div id="hint">click here to get a flower &lt;3</div>
<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const hint = document.getElementById("hint");

function resize() {
    canvas.width = innerWidth;
    canvas.height = innerHeight;
}
resize();
addEventListener("resize", resize);

const easeInOut = t =>
    t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;

class Flower {
    constructor(x, y) {
        this.x = x;
        this.baseY = y;
        this.height = 140 + Math.random() * 220;
        this.t = 0;
        this.speed = 0.006 + Math.random() * 0.004;
        this.curve = (Math.random() - 0.5) * 6;

        this.type = ["rose", "chrysanthemum", "sakura", "lavender"]
            [Math.floor(Math.random() * 4)];
    }

    drawStem(p) {
        ctx.strokeStyle = "#2f6f4e";
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(this.x, this.baseY);

        for (let i = 0; i <= 30; i++) {
            const k = i / 30 * p;
            const sway = Math.sin(k * Math.PI) * this.curve;
            ctx.lineTo(
                this.x + sway,
                this.baseY - this.height * k
            );
        }
        ctx.stroke();
    }

    drawLeaves(p) {
        if (p < 0.4) return;
        ctx.fillStyle = "#3f8f66";

        const positions = [0.45, 0.6, 0.72];
        positions.forEach((pos, i) => {
            if (p > pos) {
                const y = this.baseY - this.height * pos * p;
                const dir = i % 2 === 0 ? -1 : 1;
                ctx.beginPath();
                ctx.ellipse(
                    this.x + dir * 10,
                    y,
                    16,
                    7,
                    dir * 0.6,
                    0,
                    Math.PI * 2
                );
                ctx.fill();
            }
        });
    }

    drawBloom(top, bloom) {
        ctx.save();
        ctx.globalAlpha = bloom;

        if (this.type === "rose") {
            const layers = 3;
            for (let l = layers; l >= 1; l--) {
                ctx.fillStyle = "#b11226";
                for (let i = 0; i < 6 + l; i++) {
                    ctx.beginPath();
                    ctx.ellipse(
                        this.x + Math.cos(i) * 8 * l * bloom,
                        top + Math.sin(i) * 8 * l * bloom,
                        10 * bloom,
                        14 * bloom,
                        i,
                        0,
                        Math.PI * 2
                    );
                    ctx.fill();
                }
            }
        }

        if (this.type === "chrysanthemum") {
            ctx.fillStyle = "#f4c430";
            for (let i = 0; i < 32; i++) {
                ctx.beginPath();
                ctx.ellipse(
                    this.x + Math.cos(i) * 22 * bloom,
                    top + Math.sin(i) * 22 * bloom,
                    5 * bloom,
                    14 * bloom,
                    i,
                    0,
                    Math.PI * 2
                );
                ctx.fill();
            }
        }

        if (this.type === "sakura") {
            ctx.fillStyle = "#f6b3c8";
            for (let i = 0; i < 5; i++) {
                ctx.beginPath();
                ctx.ellipse(
                    this.x + Math.cos(i * 1.2) * 10 * bloom,
                    top + Math.sin(i * 1.2) * 10 * bloom,
                    12 * bloom,
                    18 * bloom,
                    i,
                    0,
                    Math.PI * 2
                );
                ctx.fill();
            }
        }

        if (this.type === "lavender") {
            ctx.fillStyle = "#7c5aa6";
            for (let i = 0; i < 12; i++) {
                ctx.beginPath();
                ctx.ellipse(
                    this.x,
                    top - i * 8 * bloom,
                    5 * bloom,
                    10 * bloom,
                    0,
                    0,
                    Math.PI * 2
                );
                ctx.fill();
            }
        }

        ctx.restore();
    }

    update() {
        this.t += this.speed;
        if (this.t > 1) this.t = 1;

        const p = easeInOut(this.t);
        const top = this.baseY - this.height * p;

        this.drawStem(p);
        this.drawLeaves(p);

        if (p > 0.65) {
            const bloom = (p - 0.65) / 0.35;
            this.drawBloom(top, bloom);
        }
    }
}

const flowers = [];

function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    flowers.forEach(f => f.update());
    requestAnimationFrame(animate);
}
animate();

function plant(x, y) {
    hint.style.opacity = 0;
    flowers.push(new Flower(x, y));
}

canvas.addEventListener("click", e => plant(e.clientX, e.clientY));
canvas.addEventListener("touchstart", e => {
    const t = e.touches[0];
    plant(t.clientX, t.clientY);
});
</script>

</body>
</html>
