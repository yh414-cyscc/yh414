<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Click to Have a Flower</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html, body {
    margin: 0;
    padding: 0;
    background: black;
    overflow: hidden;
    height: 100%;
    touch-action: manipulation;
}
canvas { display: block; }
#hint {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-family: Arial, sans-serif;
    font-size: 24px;
    opacity: 0.85;
    pointer-events: none;
    transition: opacity 0.6s ease;
}
</style>
</head>
<body>

<div id="hint">click to have a flower</div>
<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const hint = document.getElementById("hint");

function resize() {
    canvas.width = innerWidth;
    canvas.height = innerHeight;
}
resize();
addEventListener("resize", resize);

const easeOut = t => 1 - Math.pow(1 - t, 3);

class Flower {
    constructor(x, y) {
        this.x = x;
        this.baseY = y;
        this.height = 160 + Math.random() * 180;
        this.t = 0;
        this.speed = 0.012 + Math.random() * 0.01;
        this.sway = Math.random() * 2 + 1;

        this.type = ["rose", "chrysanthemum", "sakura", "lavender"]
            [Math.floor(Math.random() * 4)];
    }

    stemPath(progress) {
        ctx.beginPath();
        ctx.moveTo(this.x, this.baseY);
        for (let i = 0; i <= 20; i++) {
            const p = i / 20 * progress;
            const sway = Math.sin(p * Math.PI) * this.sway;
            ctx.lineTo(
                this.x + sway,
                this.baseY - this.height * p
            );
        }
        ctx.stroke();
    }

    drawLeaves(progress) {
        if (progress < 0.35) return;
        ctx.fillStyle = "#3f8f66";
        const y1 = this.baseY - this.height * 0.45 * progress;
        const y2 = this.baseY - this.height * 0.65 * progress;

        ctx.beginPath();
        ctx.ellipse(this.x - 10, y1, 14, 6, -0.6, 0, Math.PI * 2);
        ctx.fill();

        ctx.beginPath();
        ctx.ellipse(this.x + 10, y2, 14, 6, 0.6, 0, Math.PI * 2);
        ctx.fill();
    }

    drawBloom(top, bloom) {
        ctx.save();
        ctx.globalAlpha = bloom;
        ctx.shadowBlur = 10;
        ctx.shadowColor = "rgba(255,255,255,0.2)";

        if (this.type === "rose") {
            ctx.fillStyle = "#b11226";
            for (let i = 0; i < 8; i++) {
                ctx.beginPath();
                ctx.ellipse(
                    this.x + Math.cos(i) * 12 * bloom,
                    top + Math.sin(i) * 12 * bloom,
                    14 * bloom,
                    18 * bloom,
                    i,
                    0,
                    Math.PI * 2
                );
                ctx.fill();
            }
        }

        if (this.type === "chrysanthemum") {
            ctx.fillStyle = "#f4c430";
            for (let i = 0; i < 24; i++) {
                ctx.beginPath();
                ctx.ellipse(
                    this.x + Math.cos(i) * 18 * bloom,
                    top + Math.sin(i) * 18 * bloom,
                    6 * bloom,
                    14 * bloom,
                    i,
                    0,
                    Math.PI * 2
                );
                ctx.fill();
            }
        }

        if (this.type === "sakura") {
            ctx.fillStyle = "#f6b3c8";
            for (let i = 0; i < 5; i++) {
                ctx.beginPath();
                ctx.ellipse(
                    this.x + Math.cos(i * 1.2) * 10 * bloom,
                    top + Math.sin(i * 1.2) * 10 * bloom,
                    12 * bloom,
                    16 * bloom,
                    i,
                    0,
                    Math.PI * 2
                );
                ctx.fill();
            }
        }

        if (this.type === "lavender") {
            ctx.fillStyle = "#7c5aa6";
            for (let i = 0; i < 10; i++) {
                ctx.beginPath();
                ctx.ellipse(
                    this.x,
                    top - i * 8 * bloom,
                    6 * bloom,
                    12 * bloom,
                    0,
                    0,
                    Math.PI * 2
                );
                ctx.fill();
            }
        }

        ctx.restore();
    }

    update() {
        this.t += this.speed;
        if (this.t > 1) this.t = 1;

        const p = easeOut(this.t);
        const top = this.baseY - this.height * p;

        ctx.strokeStyle = "#2f6f4e";
        ctx.lineWidth = 3;
        this.stemPath(p);
        this.drawLeaves(p);

        if (p > 0.6) {
            const bloom = (p - 0.6) / 0.4;
            this.drawBloom(top, bloom);
        }
    }
}

const flowers = [];

function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    flowers.forEach(f => f.update());
    requestAnimationFrame(animate);
}
animate();

function plant(x, y) {
    hint.style.opacity = 0;
    flowers.push(new Flower(x, y));
}

canvas.addEventListener("click", e => plant(e.clientX, e.clientY));
canvas.addEventListener("touchstart", e => {
    const t = e.touches[0];
    plant(t.clientX, t.clientY);
});
</script>

</body>
</html>
